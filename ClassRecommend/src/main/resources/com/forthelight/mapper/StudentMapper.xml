<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
        
<mapper namespace="com.forthelight.dao.StudentDao">
	<resultMap id="StudentResultMap" type="Student" autoMapping="true">
		<id column="id" property="id" />
		<association property="college" column="collegeId" autoMapping="true" javaType="College"
			select="com.forthelight.dao.CollegeDao.findById" />
		<association property="major" column="MajorID" javaType="Major" autoMapping="true"
			select="com.forthelight.dao.MajorDao.findById" />
		<collection property="courses" column="id" ofType="Course" autoMapping="true"
			select="com.forthelight.dao.CourseDao.findByStudentId" />
		<collection property="files" column="id" ofType="File" autoMapping="true"
			select="com.forthelight.dao.FileDao.findByStudentId" />
	</resultMap>



	<select id="findById" parameterType="int" resultMap="StudentResultMap">
		SELECT * FROM student 
		WHERE id=#{id} AND DeleteStatus=0;
	</select>
	
	<select id="findByMajorId" resultMap="StudentResultMap" parameterType="int">
		SELECT * FROM student 
		WHERE DeleteStatus=0 AND MajorID=#{majorId};
	</select>

	<insert id="insert" parameterType="Student" >
		INSERT INTO student 
		(id, StudentName, Gender, NickName, Password, StudentNumber, Grade, CollegeID, MajorID, Privilege, DeleteStatus, studentPortrait) 
		VALUES 
		(NULL, #{studentName}, #{gender}, #{nickName}, #{password}, #{studentNumber}, #{grade},#{college.id},
		 #{major.id}, #{privilege}, 0,  #{studentPortrait});
	</insert>
	
	<select id="findByCollegeId" parameterType="int" resultMap="StudentResultMap" >
	    select * from Student
	    where collegeId = #{collegeId} and deleteStatus = 0
	</select>

	<select id="findByStudentNumber" parameterType="String" resultMap="StudentResultMap">
		SELECT * FROM student WHERE DeleteStatus=0 AND StudentNumber=#{studentNumber};
	</select>
	
	<select id="findByCourseId" parameterType="int" resultMap="StudentResultMap" >
	    select * from student
	    where id in 
	    ( select studentId from student_select_course where courseId = #{courseId} and deleteStatus = 0 )
	    and deleteStatus = 0
	</select>

	<select id="findByName" parameterType="String" resultMap="StudentResultMap">
		SELECT * FROM student WHERE deleteStatus=0 AND studentName=#{studentName};
	</select>
	
	<update id="update" parameterType="Student"  >
	    update student set
	    gender = #{gender}, nickName = #{nickName}, password = #{password},
	    collegeId = #{college.id}, majorId = #{major.id}, studentPortrait = #{studentPortrait}
	    where id = #{id}
	</update>
	
	
</mapper>